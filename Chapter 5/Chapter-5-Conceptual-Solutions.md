# Chapter-5-Conceptual-Solutions

## Questions And Answers
Exercise 5.5: Consider an MDP with a single nonterminal state and a single action that transitions back to the nonterminal state with probability ![$p$](https://render.githubusercontent.com/render/math?math=%24p%24) and transitions to the terminal state with probability ![$1-p$](https://render.githubusercontent.com/render/math?math=%241-p%24). Let the reward be +1 on all transitions, and let ![$\gamma=1$](https://render.githubusercontent.com/render/math?math=%24%5Cgamma%3D1%24). Suppose you observe one episode that lasts 10 steps, with a return of 10. What are the first-visit and every-visit estimators of the value of the nonterminal state?

The first-visit MC method estimates the value of the nonterminal state as the average of the returns following the first visit to the nonterminal state.  After visiting the nonterminal state for the first time, the episode elapses and results in a return of 10. This was the only observed episode, and so the first-visit MC method estimates the value of the nonterminal state as the average of {10}, which is just 10.

The every-visit MC method estimates the value of the nonterminal state as the average of the returns following all visits to the nonterminal state.  Following the 10th visit to the nonterminal state, a return of 1 is received; following the 9th visit to the nonterminal state, a return of 2 is received; and so on. The average of the returns following all visits to the nonterminal state is thus the average of {1, 2, 3, 4, 5, 6, 7, 8, 9, 10} = 5.5.

Exercise 5.7: In learning curves such as those shown in Figure 5.3 error generally decreases with training, as indeed happened for the ordinary importance sampling method. But for the weighted importance sampling method error first increased and then decreased. Why do you think this happened?

I think that the error initially increased and then subsequently decreased for the weighted importance sampling method because weighted importance sampling is a statistcally biased estimate of the value function (with a bias that converges asymptotically to zero).  The behavior after a few initial episodes reflects the biased estimation, while the behavior after many episodes reflects the bias decreasing to zero.

Exercise 5.10: Derive the weighted-average update rule (5.8) from (5.7). Follow the pattern of the derivation of the unweighted rule (2.3).

From (5.7), ![$V_{n+1} = \frac{\sum_{k=1}^{n} W_k G_k}{\sum_{k=1}^{n} W_k}$](https://render.githubusercontent.com/render/math?math=%24V_%7Bn%2B1%7D%20%3D%20%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5E%7Bn%7D%20W_k%20G_k%7D%7B%5Csum_%7Bk%3D1%7D%5E%7Bn%7D%20W_k%7D%24).  Denoting the cumulative sum of the weights of the first ![$n$](https://render.githubusercontent.com/render/math?math=%24n%24) returns by ![$C_n$](https://render.githubusercontent.com/render/math?math=%24C_n%24) (i.e., ![$C_n = \sum_{k=1}^{n} W_k$](https://render.githubusercontent.com/render/math?math=%24C_n%20%3D%20%5Csum_%7Bk%3D1%7D%5E%7Bn%7D%20W_k%24)), and proceeding in a manner analogous to what was done in Chapter 2,

![\begin{align*} V_{n+1} &= \frac{\sum_{k=1}^{n} W_k G_k}{\sum_{k=1}^{n} W_k} \\ &= \frac{1}{C_n} \sum_{k=1}^{n} W_k G_k \\ &= \frac{1}{C_n} \left( W_n G_n + \sum_{k=1}^{n-1} W_k G_k \right) \\ &= \frac{1}{C_n} \left( W_n G_n + \frac{C_{n-1}}{C_{n-1}} \sum_{k=1}^{n-1} W_k G_k \right) \\ &= \frac{1}{C_n} \left( W_n G_n + C_{n-1} V_n \right) \\ &= \frac{1}{C_n} \left( W_n G_n + C_n V_n - W_n V_n \right) \\ &= V_n + \frac{W_n}{C_n} \left\[ G_n - V_n \right\] \end{align*}](https://render.githubusercontent.com/render/math?math=%5Cbegin%7Balign*%7D%20V_%7Bn%2B1%7D%20%26%3D%20%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5E%7Bn%7D%20W_k%20G_k%7D%7B%5Csum_%7Bk%3D1%7D%5E%7Bn%7D%20W_k%7D%20%5C%5C%20%26%3D%20%5Cfrac%7B1%7D%7BC_n%7D%20%5Csum_%7Bk%3D1%7D%5E%7Bn%7D%20W_k%20G_k%20%5C%5C%20%26%3D%20%5Cfrac%7B1%7D%7BC_n%7D%20%5Cleft(%20W_n%20G_n%20%2B%20%5Csum_%7Bk%3D1%7D%5E%7Bn-1%7D%20W_k%20G_k%20%5Cright)%20%5C%5C%20%26%3D%20%5Cfrac%7B1%7D%7BC_n%7D%20%5Cleft(%20W_n%20G_n%20%2B%20%5Cfrac%7BC_%7Bn-1%7D%7D%7BC_%7Bn-1%7D%7D%20%5Csum_%7Bk%3D1%7D%5E%7Bn-1%7D%20W_k%20G_k%20%5Cright)%20%5C%5C%20%26%3D%20%5Cfrac%7B1%7D%7BC_n%7D%20%5Cleft(%20W_n%20G_n%20%2B%20C_%7Bn-1%7D%20V_n%20%5Cright)%20%5C%5C%20%26%3D%20%5Cfrac%7B1%7D%7BC_n%7D%20%5Cleft(%20W_n%20G_n%20%2B%20C_n%20V_n%20-%20W_n%20V_n%20%5Cright)%20%5C%5C%20%26%3D%20V_n%20%2B%20%5Cfrac%7BW_n%7D%7BC_n%7D%20%5Cleft%5B%20G_n%20-%20V_n%20%5Cright%5D%20%5Cend%7Balign*%7D),

which is the weighted-average update rule (5.8).
